const http=require("http"),path=require("path"),fs=require("fs"),querystring=require("querystring"),nodemailer=require("nodemailer"),compression=require("compression"),PORT=process.env.PORT||5e3;let requestCount=0;const server=http.createServer(compression(),(e,t)=>{if(requestCount++,"/"===e.url)fs.readFile(path.join(__dirname,"views","index.html"),(e,r)=>{if(e)throw e;t.writeHead(200,{"Content-Type":"text/html; charset=UTF-8","Cache-Control":"public, max-age=31536000"}),t.end(r)});else if(e.url.startsWith("/public/"))fs.readFile(path.join(__dirname,e.url),(r,n)=>{if(r)throw r;const o=path.extname(e.url);let s="text/html",l="public, max-age=315360000";".css"===o&&(s="text/css"),".js"===o&&(s="application/javascript",l="public, max-age=86400"),t.writeHead(200,{"Content-Type":s,"Cache-Control":l}),t.end(n)});else if("/send-email"===e.url&&"POST"===e.method){let r="";e.on("data",e=>{r+=e.toString()}),e.on("end",()=>{const e=querystring.parse(r),n=nodemailer.createTransport({service:"gmail",auth:{user:"chandlerpaulk59@gmail.com",pass:"rnmf dhlw clkz cjxd"}}),o={from:e.from+"<chandlerpaulk59@gmail.com>",to:"chandlerpaulk59@gmail.com",subject:e.subject+" - Portfolio Contact",text:e.message};n.sendMail(o,(e,r)=>{e?(console.log(e),t.writeHead(500,{"Content-Type":"text/html"}),t.end("An error occurred while trying to send the email.")):(console.log(`Email sent: ${r.response}`),t.writeHead(200,{"Content-Type":"text/html","Cache-Control":"no-store"}),t.end("Email sent successfully!"))})})}else t.writeHead(404,{"Content-Type":"text/html"}),t.end("404 Not Found")});server.listen(PORT,e=>{e&&console.log("Error in server setup"),console.log(`Server listening on Port: ${PORT}\nHTTP Request count: ${requestCount}`)});