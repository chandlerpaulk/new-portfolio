const http=require("http"),path=require("path"),fs=require("fs"),querystring=require("querystring"),nodemailer=require("nodemailer"),zlib=require("zlib"),cache=new Map,PORT=process.env.PORT||5e3,server=http.createServer((e,t)=>{if("/"===e.url)if(cache.has("index.html")){const e=cache.get("index.html");t.writeHead(200,e.headers),t.end(e.data)}else fs.readFile(path.join(__dirname,"views","index.html"),(n,a)=>{if(n)throw n;const r=e.headers["accept-encoding"];return r&&r.match(/\b(gzip|deflate)\b/)?r.match(/\bgzip\b/)?(t.writeHead(200,{"Content-Encoding":"gzip","Content-Type":"text/html; charset=utf-8","Cache-Control":"public, max-age=31536000"}),void zlib.gzip(a,(e,n)=>{if(e)throw e;t.end(n),cache.set("index.html",{headers:{"Content-Encoding":"gzip","Content-Type":"text/html; charset=utf-8","Cache-Control":"public, max-age=31536000"},data:n})})):r.match(/\bdeflate\b/)?(t.writeHead(200,{"Content-Encoding":"deflate","Content-Type":"text/html; charset=utf-8","Cache-Control":"public, max-age=31536000"}),void zlib.gzip(a,(e,n)=>{if(e)throw e;t.end(n),cache.set("index.html",{headers:{"Content-Encoding":"deflate","Content-Type":"text/hmtl; charset=utf-8","Cache-Control":"public, max-age=31536000"},data:n})})):void 0:(t.writeHead(200,{"Content-Type":"text/html; charset=utf-8","Cache-Control":"public, max-age=31536000"}),t.end(a),void cache.set("index.html",{headers:{"Content-Type":"text/html; charset=utf-8","Cache-Control":"public, max-age=31536000"},data:a}))});else if("/send-email"===e.url&&"POST"===e.method){let n="";e.on("data",e=>{n+=e.toString()}),e.on("end",()=>{const e=querystring.parse(n),a=nodemailer.createTransport({service:"gmail",auth:{user:"chandlerpaulk59@gmail.com",pass:"rnmf dhlw clkz cjxd"}}),r={from:e.from+"<chandlerpaulk59@gmail.com>",to:"chandlerpaulk59@gmail.com",subject:e.subject+" - Portfolio Contact",text:e.message};a.sendMail(r,(e,n)=>{e?(console.log(e),t.writeHead(500,{"Content-Type":"text/html"}),t.end("An error occurred while trying to send the email.")):(console.log(`Email sent: ${n.response}`),t.writeHead(200,{"Content-Type":"text/html","Cache-Control":"no-store"}),t.end("Email sent successfully!"))})})}else t.writeHead(404,{"Content-Type":"text/html"}),t.end("404 Not Found")});server.listen(PORT,()=>{console.log(`Server running on http://localhost:${PORT}`)});